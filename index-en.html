<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word Slot Machine</title>
  <style>
    :root{
      --bg: radial-gradient(1200px 800px at 50% 10%, #1f2330 0%, #0f1219 55%, #0b0e14 100%);
      --card:#161a24cc;
      --cardBorder:#2b314280;
      --accent:#ffd53b;
      --accent-2:#6cf;
      --text:#e9eefc;
      --muted:#9aa5bd;
      --win:#69f0ae;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg); color:var(--text); display:grid; place-items:center; padding:24px;
    }
    .wrap{width:min(980px, 100%);}
    .card{
      background: var(--card); border:1px solid var(--cardBorder); border-radius:20px; padding:24px; box-shadow: 0 20px 60px #0007;
    }
    h1{margin:0 0 8px; font-size:clamp(22px, 3vw, 36px); letter-spacing:.3px}
    .sub{color:var(--muted); margin-bottom:18px}

    .reels{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:14px; margin:14px 0 8px}
    .reel{
      position:relative; height:92px; border-radius:16px; border:1px solid var(--cardBorder); background:#0e1119;
      display:grid; place-items:center; overflow:hidden; box-shadow: inset 0 0 0 1px #0006, inset 0 -12px 24px #0007;
    }
    .slot-word{font-weight:700; font-size: clamp(26px, 5vw, 36px); letter-spacing:.2px; text-shadow: 0 2px 0 #000;}

    .btns{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:16px}
    button{
      appearance:none; border:1px solid var(--cardBorder); background:#111629; color:var(--text);
      padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer; transition:.2s transform, .2s filter, .2s opacity;
    }
    button.primary{ background: linear-gradient(180deg, #2030ff 0%, #1a2bd8 100%); border-color:#2f3cff; }
    button.primary:disabled{opacity:.6; cursor:not-allowed}
    button:hover{filter:brightness(1.08)}
    button:active{transform:translateY(1px)}

    .lever{ margin-left:auto; display:flex; align-items:center; gap:8px }
    .ball{width:22px;height:22px;border-radius:50%;background:var(--accent); box-shadow:0 0 0 3px #0006, 0 0 18px #ffda61aa}
    .stick{width:5px;height:28px;background:#333;border-radius:3px}

    .result{margin-top:12px; font-size:clamp(18px, 2.3vw, 22px)}
    .sentence{font-weight:800}
    .hint{color:var(--muted); font-size:14px; margin-top:2px}

    .ticker{position:absolute; inset:0; display:grid; place-items:center;}
    .ticker span{display:block; will-change:transform}

    .blink{animation:blink 1s infinite}
    @keyframes blink{50%{opacity:.35}}

    .win{color:var(--win)}
    .accent{color:var(--accent)}
    .muted{color:var(--muted)}

    .small{font-size:13px; color:var(--muted)}
    .ai.card{background:linear-gradient(180deg, #141827, #101522);}
  </style>
</head>
<body>
  <div class="wrap card">
    <h1>Guardian Angel</h1>
    <div class="sub">Pull the lever and see the guardian angel we assign to you for today.</div>

    <div class="reels" id="reels">
      <div class="reel" data-type="adj"><div class="ticker"><span class="slot-word">—</span></div></div>
      <div class="reel" data-type="who"><div class="ticker"><span class="slot-word">—</span></div></div>
      <div class="reel" data-type="verb"><div class="ticker"><span class="slot-word">—</span></div></div>
    </div>

    <div class="btns">
      <button id="spinBtn" class="primary">Pull</button>
      <button id="shuffleBtn">Shuffle lists</button>
      <button id="copyBtn">Copy sentence</button>
      <button id="imgBtn">Generate image (AI)</button>
      <div class="lever" aria-hidden="true">
        <div class="stick"></div>
        <div class="ball" id="ball"></div>
      </div>
    </div>

    <div class="result" id="result"><span class="muted">Press “Spin”.</span></div>
    <div class="hint small">
      To change the words, edit the arrays <code>ADJ</code>, <code>WHO</code>, <code>VERB</code> in the script.
    </div>

    <div class="ai card" style="margin-top:16px;">
      <div style="display:flex; gap:16px; align-items:flex-start; flex-wrap:wrap;">
        <div style="flex:1 1 280px; min-width:260px">
          <div class="small" style="margin-bottom:6px; color:var(--muted)">
            AI prompt (auto-filled — you can edit it):
          </div>
          <textarea id="aiPrompt" rows="4" style="width:100%; background:#0e1119; color:var(--text); border:1px solid var(--cardBorder); border-radius:10px; padding:10px; resize:vertical"></textarea>
          <div style="display:flex; gap:8px; margin-top:8px">
            <button id="copyPromptBtn">Copy prompt</button>
            <button id="sendToApiBtn" title="POST to window.AI_ENDPOINT">Send to API</button>
          </div>
          <div class="small" style="margin-top:6px; color:var(--muted)">
            * Set <code>window.AI_ENDPOINT</code> to auto-generate an image after each spin.
          </div>
        </div>
        <div style="flex:1 1 320px; min-width:260px">
          <div class="small" style="margin-bottom:6px; color:var(--muted)">Generated image:</div>
          <div id="aiImgWrap" style="aspect-ratio:16/9; background:#0e1119; border:1px solid var(--cardBorder); border-radius:12px; display:grid; place-items:center; overflow:hidden">
            <img id="aiImg" alt="AI result" style="max-width:100%; max-height:100%; display:none"/>
            <span id="aiPlaceholder" class="muted">No image yet</span>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
// === Data ===
const ADJ = [
  "arrogant","beautiful","dumb","noble","hungry","desperate","drunk","angry",
  "cunning","kind","ruthless","sentimental","sour","confident","nervous","secretive",
  "furious","calm","generous","determined","modest","loud","dizzy","cheerful"
];
const WHO = [
  "Elon Musk","Madonna","Chuck Norris","Donald Trump","Cleopatra","Hristo Stoichkov","Vladimir Putin","Lady Gaga",
  "Beyoncé","Leo Messi","Cristiano Ronaldo","Mikhail Gorbachev","Albert Einstein","Nikola Tesla","Adele","Oprah Winfrey",
  "Boyko Borisov","Kiril Petkov","Dimitar Berbatov","Steve Jobs","Billie Eilish","Shakira","Greta Thunberg","Rihanna"
];
const VERB = [
  "dances","steals","preaches","swears","cooks","cries","streams","repairs",
  "flies","ponders","paints","sabotages","bluffs","farms","taps","serves",
  "refines","gathers","trains","docks","sings","drives","invests","tweets"
];

// State
let spinning = false;
const reels = [...document.querySelectorAll('.reel')].map((el, idx)=>({
  el,
  idx,
  type: el.dataset.type,
  ticker: el.querySelector('.ticker span'),
  interval: null,
  value: '—'
}));

const spinBtn = document.getElementById('spinBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const copyBtn = document.getElementById('copyBtn');
const resultEl = document.getElementById('result');
const ball = document.getElementById('ball');
const imgBtn = document.getElementById('imgBtn');
const aiPromptEl = document.getElementById('aiPrompt');
const aiImg = document.getElementById('aiImg');
const aiPlaceholder = document.getElementById('aiPlaceholder');
const copyPromptBtn = document.getElementById('copyPromptBtn');
const sendToApiBtn = document.getElementById('sendToApiBtn');

function byType(type){
  if(type==='adj') return ADJ;
  if(type==='who') return WHO;
  return VERB;
}
function randOf(arr){return arr[Math.floor(Math.random()*arr.length)]}
function setWord(reel, w){ reel.ticker.textContent = w; reel.value = w; }

function animateLever(active){
  ball.style.transform = active ? 'translateY(8px)' : 'translateY(0)';
  ball.style.filter = active ? 'brightness(1.15)' : 'none';
}

function spinOne(reel, duration){
  const words = byType(reel.type);
  clearInterval(reel.interval);
  reel.interval = setInterval(()=>{ setWord(reel, randOf(words)); }, 60);
  return new Promise(res=>{
    setTimeout(()=>{
      clearInterval(reel.interval);
      let ticks = 8 + Math.floor(Math.random()*6);
      const tick = ()=>{
        setWord(reel, randOf(words));
        if(--ticks>0){ setTimeout(tick, Math.min(120+ (8-ticks)*12, 220)); }
        else res();
      };
      tick();
    }, duration);
  });
}

async function spin(){
  if(spinning) return; spinning = true;
  spinBtn.disabled = true; animateLever(true);
  resultEl.innerHTML = '<span class="muted blink">… spinning …</span>';

  const base = 600 + Math.random()*400;
  await Promise.all([
    spinOne(reels[0], base),
    spinOne(reels[1], base + 420),
    spinOne(reels[2], base + 840)
  ]);

  animateLever(false); spinBtn.disabled = false; spinning = false;
  showSentence();
}

function showSentence(){
  const [a,b,c] = reels.map(r=>r.value);
  const s = `${capitalize(a)} ${b} ${c}.`;
  const isFunny = (a.length + b.length + c.length) % 7 === 0;
  resultEl.innerHTML = `<span class="sentence ${isFunny?'win':''}">${s}</span>`;
  preparePromptUI();
  if(window.AI_AUTOGEN !== false){
    generateViaApi();
  }
}

function capitalize(str){ return str.charAt(0).toUpperCase() + str.slice(1); }

function shuffleLists(){
  [ADJ, WHO, VERB].forEach(arr=>{
    for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  });
  reels.forEach(r=> setWord(r, '—'));
  resultEl.innerHTML = '<span class="muted">Lists shuffled. Spin again.</span>';
}

function copySentence(){
  const text = resultEl.textContent.trim();
  if(!text) return;
  navigator.clipboard.writeText(text).then(()=>{
    copyBtn.textContent = 'Copied!';
    setTimeout(()=>copyBtn.textContent='Copy sentence', 1000);
  });
}

function buildPrompt(){
  const [a,b,c] = reels.map(r=>r.value);
  const base = `${capitalize(a)} ${b} ${c}.`;
  const style = 'cinematic photorealism, 3:2, sharp focus, soft diffuse light, professional portrait/scene, natural colors';
  const safety = 'no blood, no violence, no nudity, no logos, no text on the image';
  return `Create a scene illustrating: "${base}" — composition with ${b} as the character, expression conveying "${a}", while they ${c}. ${style}. ${safety}.`;
}

function preparePromptUI(){ aiPromptEl.value = buildPrompt(); }

async function generateViaApi(){
  const endpoint = window.AI_ENDPOINT;
  const payload = { prompt: aiPromptEl.value, size: 'landscape' };
  if(!endpoint){
    console.log('AI DEMO: window.AI_ENDPOINT is not set. payload =>', payload);
    return;
  }
  try{
    sendToApiBtn.disabled = true; sendToApiBtn.textContent = 'Generating…';
    const res = await fetch(endpoint,{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data = await res.json();
    if(data.image_url){ aiImg.src = data.image_url; aiImg.style.display='block'; aiPlaceholder.style.display='none'; }
    else throw new Error('Missing image_url');
  }catch(err){
    alert('Request error: '+err.message);
    console.error(err);
  }finally{ sendToApiBtn.disabled = false; sendToApiBtn.textContent = 'Send to API'; }
}

// === Events ===
spinBtn.addEventListener('click', spin);
shuffleBtn.addEventListener('click', shuffleLists);
copyBtn.addEventListener('click', copySentence);
imgBtn.addEventListener('click', ()=>{ preparePromptUI(); aiPromptEl.scrollIntoView({behavior:'smooth', block:'center'}); });
copyPromptBtn.addEventListener('click', ()=>{ navigator.clipboard.writeText(aiPromptEl.value); copyPromptBtn.textContent='Copied!'; setTimeout(()=>copyPromptBtn.textContent='Copy prompt', 1000); });
sendToApiBtn.addEventListener('click', generateViaApi);
window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); spin(); } });

// initial render
reels.forEach((r,i)=> setWord(r, ['arrogant','Cleopatra','dances'][i] || '—'));
showSentence();

// config (optional)
// window.AI_ENDPOINT = 'https://your-domain.com/api/image';
// window.AI_AUTOGEN = true;
</script>
</body>
</html>
